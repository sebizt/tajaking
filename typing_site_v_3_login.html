<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì²œì•ˆì˜¤ì„±ê³ ë“±í•™êµ íƒ€ìì™• ì±Œë¦°ì§€ - ì…ì¥</title>
  <link rel="stylesheet" href="./typing_site_v_3_app.css" />
</head>
<body>
  <header class="hero">
    <div class="hero__inner">
      <div class="hero__logo">
        <img src="./school-logo.png" alt="í•™êµ ë¡œê³ " class="logo" onerror="this.style.display='none'" />
        <span class="badge">OSHS</span>
      </div>
      <h1 class="hero__title">
        <a href="index.html" style="text-decoration:none; color:inherit;">ì˜¤ì„± íƒ€ìì™•</a>
      </h1>
      <p class="hero__sub">í•™ë²ˆê³¼ ì´ë¦„, ì—°ìŠµ ëª¨ë“œë¥¼ ì„ íƒí•˜ê³  ì…ì¥í•˜ì„¸ìš”!</p>
    </div>
  </header>

  <main class="container">
    <section class="card card--win" aria-labelledby="title-login">
      <div class="winbar">
        <span class="winbar__dot"></span>
        <span id="title-login" class="winbar__title">ì…ì¥í•˜ê¸°</span>
      </div>
      <div class="section-card">
        <form id="loginForm" action="./typing_site_v_3_practice.html" method="get" class="grid" style="gap:16px">
          <!-- í•™ë²ˆ/ì´ë¦„ -->
          <div class="grid grid-2" style="grid-column:1/-1">
            <label class="field">
              <span>í•™ë²ˆ</span>
              <input id="studentId" name="sid" placeholder="ì˜ˆ: 20401" autocomplete="off" required />
            </label>
            <label class="field">
              <span>ì´ë¦„</span>
              <input id="studentName" name="sname" placeholder="ì˜ˆ: í™ê¸¸ë™" autocomplete="off" required />
            </label>
          </div>

          <!-- ëª¨ë“œ ì„ íƒ -->
          <fieldset class="field" style="grid-column:1/-1">
            <span>ì—°ìŠµ ëª¨ë“œ</span>
            <div class="row gap" style="gap:16px; padding-top:4px">
              <label>
                <input type="radio" name="mode" value="solo" checked> í˜¼ìí•˜ê¸° (ê¸´ ê¸€)
              </label>
              <label>
                <input type="radio" name="mode" value="together"> í•¨ê»˜í•˜ê¸° (ë‹¨ì–´)
              </label>
            </div>
          </fieldset>

          <!-- ì„ ìƒë‹˜ ì„±í•¨ (í•¨ê»˜í•˜ê¸°ì—ì„œë§Œ í‘œê¸°/í•„ìˆ˜) -->
          <div id="teacherWrap" class="grid grid-2" style="grid-column:1/-1; display:none">
            <label class="field" style="grid-column:1/-1">
              <span>ì„ ìƒë‹˜ ì„±í•¨ (í•¨ê»˜í•˜ê¸°)</span>
              <input id="teacherName" name="teacher" placeholder="ì˜ˆ: ê¹€OO ì„ ìƒë‹˜" autocomplete="off" />
            </label>
          </div>

          <div class="actions" style="grid-column:1/-1">
            <button type="submit" id="startBtn" class="btn btn--primary">ì‹œì‘í•˜ê¸°</button>
          </div>

          <p id="msg" class="muted" role="status" style="grid-column:1/-1"></p>
        </form>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const USER_KEY = 'typing_user_v9';
      const $ = (s)=>document.querySelector(s);
      const idEl = $('#studentId');
      const nameEl = $('#studentName');
      const form = $('#loginForm');
      const msg = $('#msg');
      const teacherWrap = $('#teacherWrap');
      const teacherInput = $('#teacherName');

      // ğŸ”¹ ëª¨ë“œ ë¼ë””ì˜¤ë“¤
      const modeRadios = form.querySelectorAll('input[name="mode"]');

      // ğŸ”¹ ì´ì „ ê¸°ë¡ ì±„ìš°ê¸° (id, name, mode, teacher)
      try {
        const u = JSON.parse(localStorage.getItem(USER_KEY) || 'null');
        if (u) {
          if (u.id)   idEl.value = u.id;
          if (u.name) nameEl.value = u.name;

          // ì €ì¥ëœ ëª¨ë“œ ë³µì›
          if (u.mode === 'together' || u.mode === 'solo') {
            modeRadios.forEach(radio => {
              radio.checked = (radio.value === u.mode);
            });

            const together = (u.mode === 'together');
            teacherWrap.style.display = together ? 'grid' : 'none';
            teacherInput.required = together;
          }

          // ì €ì¥ëœ ì„ ìƒë‹˜ ì´ë¦„ ë³µì›
          if (u.teacher) {
            teacherInput.value = u.teacher;
          }
        }
      } catch(e){}

      // ğŸ”¹ ëª¨ë“œ ë³€ê²½ ì‹œ: í•¨ê»˜í•˜ê¸°ë©´ ì„ ìƒë‹˜ ì„±í•¨ ì˜ì—­ ë³´ì´ê³  í•„ìˆ˜
      form.addEventListener('change', () => {
        const fd = new FormData(form);
        const mode = (fd.get('mode') || 'solo');
        const together = (mode === 'together');
        teacherWrap.style.display = together ? 'grid' : 'none';
        teacherInput.required = together;
      });

      // ğŸ”¹ ì œì¶œ ê²€ì¦ + localStorage ì €ì¥
      form.addEventListener('submit', (e)=>{
        const fd = new FormData(form);
        const id = (fd.get('sid') || '').trim();
        const name = (fd.get('sname') || '').trim();
        const mode = (fd.get('mode') || 'solo');
        const teacher = (fd.get('teacher') || '').trim();

        if (!id || !name) {
          e.preventDefault();
          msg.textContent = 'í•™ë²ˆê³¼ ì´ë¦„ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }
        if (mode === 'together' && !teacher) {
          e.preventDefault();
          msg.textContent = 'í•¨ê»˜í•˜ê¸°ë¥¼ ì„ íƒí•˜ë©´ ì„ ìƒë‹˜ ì„±í•¨ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.';
          return;
        }

        // ğŸ”¹ "í•™ìƒ + êµì‚¬" í˜•ì‹ ë¬¸ìì—´
        const pairLabel = (mode === 'together' && teacher)
          ? `${name} & ${teacher}`
          : `${name}`;

        // ğŸ”¹ localStorageì— ëª¨ë“œ/êµì‚¬ê¹Œì§€ ëª¨ë‘ ì €ì¥
        const payload = { id, name, mode, teacher, pair: pairLabel };

        try {
          localStorage.setItem(USER_KEY, JSON.stringify(payload));
        } catch(_) {}

        // ê¸°ë³¸ submit â†’ typing_site_v_3_practice.html?sid=..&sname=..&mode=..&teacher=..
      });
    })();
  </script>

  <!-- firebase ì´ˆê¸°í™” ë¨¼ì € -->
  <script type="module" src="firebase_init.js"></script>
</body>
</html>
