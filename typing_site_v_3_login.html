<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>천안오성고등학교 타자왕 챌린지 - 입장</title>
  <link rel="stylesheet" href="./typing_site_v_3_app.css" />
</head>
<body>
  <header class="hero">
    <div class="hero__inner">
      <div class="hero__logo">
        <img src="./school-logo.png" alt="학교 로고" class="logo" onerror="this.style.display='none'" />
        <span class="badge">OSHS</span>
      </div>
      <h1 class="hero__title">오성 타자왕</h1>
      <p class="hero__sub">학번과 이름, 연습 모드를 선택하고 입장하세요!</p>
    </div>
  </header>

  <main class="container">
    <section class="card card--win" aria-labelledby="title-login">
      <div class="winbar"><span class="winbar__dot"></span><span id="title-login" class="winbar__title">입장하기</span></div>
      <div class="section-card">
        <form id="loginForm" action="./typing_site_v_3_practice.html" method="get" class="grid" style="gap:16px">
          <!-- 학번/이름 -->
          <div class="grid grid-2" style="grid-column:1/-1">
            <label class="field"><span>학번</span><input id="studentId" name="sid" placeholder="예: 20401" autocomplete="off" required /></label>
            <label class="field"><span>이름</span><input id="studentName" name="sname" placeholder="예: 홍길동" autocomplete="off" required /></label>
          </div>

          <!-- 모드 선택 -->
          <fieldset class="field" style="grid-column:1/-1">
            <span>연습 모드</span>
            <div class="row gap" style="gap:16px; padding-top:4px">
              <label><input type="radio" name="mode" value="solo" checked> 혼자하기 (긴 글)</label>
              <label><input type="radio" name="mode" value="together"> 함께하기 (단어)</label>
            </div>
          </fieldset>

          <!-- 선생님 성함 (함께하기에서만 표기/필수) -->
          <div id="teacherWrap" class="grid grid-2" style="grid-column:1/-1; display:none">
            <label class="field" style="grid-column:1/-1">
              <span>선생님 성함 (함께하기)</span>
              <input id="teacherName" name="teacher" placeholder="예: 김OO 선생님" autocomplete="off" />
            </label>
          </div>

          <div class="actions" style="grid-column:1/-1">
            <button type="submit" id="startBtn" class="btn btn--primary">시작하기</button>
          </div>

          <p id="msg" class="muted" role="status" style="grid-column:1/-1"></p>
        </form>
      </div>
    </section>
  </main>

  <script>
    (function(){
      const USER_KEY = 'typing_user_v9';
      const $ = (s)=>document.querySelector(s);
      const idEl = $('#studentId');
      const nameEl = $('#studentName');
      const form = $('#loginForm');
      const msg = $('#msg');
      const teacherWrap = $('#teacherWrap');
      const teacherInput = $('#teacherName');

      // 이전 기록 채우기
      try {
        const u = JSON.parse(localStorage.getItem(USER_KEY)||'null');
        if (u){ idEl.value = u.id||''; nameEl.value = u.name||''; }
      } catch(e){}

      // 모드 토글 → 함께하기면 선생님 성함 보이기+필수
      form.addEventListener('change', (e)=>{
        const mode = new FormData(form).get('mode');
        const together = (mode === 'together');
        teacherWrap.style.display = together ? 'grid' : 'none';
        teacherInput.required = together;
      });

      // 제출 검증 + localStorage 저장
      form.addEventListener('submit', (e)=>{
        const fd = new FormData(form);
        const id = (fd.get('sid')||'').trim();
        const name = (fd.get('sname')||'').trim();
        const mode = (fd.get('mode')||'solo');
        const teacher = (fd.get('teacher')||'').trim();

        if (!id || !name){
          e.preventDefault(); msg.textContent = '학번과 이름을 모두 입력하세요.'; return;
        }
        if (mode === 'together' && !teacher){
          e.preventDefault(); msg.textContent = '함께하기를 선택하면 선생님 성함을 입력해야 합니다.'; return;
        }
        try { localStorage.setItem(USER_KEY, JSON.stringify({id,name})); } catch(_){}
        // 기본 제출 → practice.html?sid=..&sname=..&mode=..&teacher=..
      });
    })();
  </script>
</body>
</html>
